% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_decision_rate.R
\name{plot_decision_rate}
\alias{plot_decision_rate}
\title{Plot Decision Rate (Stacked Bar with Overlaid Points)}
\usage{
plot_decision_rate(
  data,
  data_se = NULL,
  cohort_status = NULL,
  fade_open_cohorts = TRUE,
  show_phe = TRUE,
  phe_label_y = 1.02,
  show_labels = TRUE,
  show_points = TRUE,
  fill_colors = c(`Withdrawn or Deleted (Not Cleared)` = "darkgray", `NSE (Not Cleared)`
    = "darkred", `SE (Cleared)` = "cornflowerblue"),
  facet_ncol = 4L,
  title = NULL,
  subtitle = NULL,
  caption = NULL
)
}
\arguments{
\item{data}{A data frame containing decision rate metrics with columns:
\code{fy}, \code{org}, \code{percent} (0-1 scale), \code{decision} (factor with levels for
stacking order).}

\item{data_se}{A data frame containing just the SE (cleared) data for
overlaying points and labels. Should have: \code{fy}, \code{org}, \code{percent}, and
optionally \code{status} and \code{percent_closed} for cohort status styling.}

\item{cohort_status}{Optional data frame with cohort status for fading bars.
Should have: \code{fy}, \code{org}, \code{percent_closed}, \code{status}. If NULL and data_se
contains these columns, they will be used.}

\item{fade_open_cohorts}{Logical, whether to reduce opacity for open cohorts
(default: TRUE). Requires cohort status data.}

\item{show_phe}{Logical, whether to show COVID-19 Public Health Emergency
highlighting (default: TRUE).}

\item{phe_label_y}{Numeric, y-axis position for the PHE label
(default: 1.02).}

\item{show_labels}{Logical, whether to show percentage labels on SE bars
(default: TRUE).}

\item{show_points}{Logical, whether to show points on SE bars
(default: TRUE).}

\item{fill_colors}{Named vector of colors for decision categories. Default
uses cornflowerblue for SE, darkred for NSE, darkgray for Withdrawn.}

\item{facet_ncol}{Number of columns in facet grid (default: 4).}

\item{title}{Optional plot title. If NULL, a default title is generated.}

\item{subtitle}{Optional plot subtitle. If NULL, a default subtitle is used.}

\item{caption}{Plot caption. If NULL (default), auto-generates a caption
listing source reports with cutoff dates using
\code{\link{source_caption_with_dates}}. If FALSE or NA, no caption is
shown. If a character string, uses that value.}
}
\value{
A ggplot2 object that can be further customized with \code{+}.
}
\description{
Creates a stacked bar visualization of decision rates (SE/NSE/Withdrawn)
with optional points and labels overlaid on the "cleared" (SE) bars.
}
\details{
The plot displays decision rates using:
\itemize{
\item Stacked bars showing the proportion of each decision type
\item Points on the SE (cleared) bars indicating cohort status
\item Text labels showing the SE percentage
}

The \code{decision} column should be a factor with levels in the desired stacking
order (bottom to top). Typically:
\itemize{
\item "SE (Cleared)" at the bottom
\item "NSE (Not Cleared)" in the middle
\item "Withdrawn or Deleted (Not Cleared)" at the top
}

The function uses \code{fct_rev()} internally to reverse the legend order so it
matches the visual stacking order.
}
\examples{
\dontrun{
# Prepare decision data
data_decision <- data |>
  mutate(
    decision = case_when(
      str_detect(metric, "SE") ~ "SE (Cleared)",
      str_detect(metric, "NSE") ~ "NSE (Not Cleared)",
      TRUE ~ "Withdrawn or Deleted (Not Cleared)"
    ) |> as_factor() |> fct_rev()
  ) |>
  group_by(fy, org) |>
  mutate(percent = value / sum(value))

# Extract SE data with cohort status
data_se <- data_decision |>
  filter(str_detect(decision, "^SE")) |>
  left_join(cohort_status, by = c("fy", "org"))

# Create plot
plot_decision_rate(
  data_decision,
  data_se = data_se,
  title = "510(k) Decision Rates"
)
}
}
